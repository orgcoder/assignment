{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.journals = exports.licenses = exports.types = exports.members = exports.funders = exports.works = exports.journalWorks = exports.memberWorks = exports.prefixWorks = exports.funderWorks = exports.journal = exports.type = exports.member = exports.prefix = exports.funder = exports.work = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _request = require('request');\n\nvar _request2 = _interopRequireDefault(_request);\n\nvar _assign = require('lodash/assign');\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar endpoint = 'https://api.crossref.org/';\nvar timeout = 60 * 1000; // CrossRef is *very* slow\n// make a request\n\nfunction GET(path, cb) {\n  // console.log(`### ${endpoint}${path}`);\n  (0, _request2.default)({\n    url: '' + endpoint + path,\n    json: true,\n    timeout: timeout\n  }, function (err, res, body) {\n    if (err || !res || res.statusCode >= 400) {\n      var statusCode = res ? res.statusCode : 0,\n          statusMessage = res ? res.statusMessage : 'Unspecified error (likely a timeout)';\n\n      if (statusCode === 429) {\n        var headers = res.headers || {},\n            limit = headers['x-rate-limit-limit'] || 'N/A',\n            interval = headers['x-rate-limit-interval'] || 'N/A';\n        return cb(new Error('Rate limit exceeded: ' + limit + ' requests in ' + interval));\n      }\n\n      if (statusCode === 404) return cb(new Error('Not found on CrossRef: \\'' + endpoint + path + '\\''));\n      var msg = err && err.message ? err.message : statusMessage;\n      return cb(new Error('CrossRef error: [' + statusCode + '] ' + msg));\n    }\n\n    if ((typeof body === 'undefined' ? 'undefined' : _typeof(body)) !== 'object') return cb(new Error('CrossRef response was not JSON: ' + body));\n    if (!body.status) return cb(new Error('Malformed CrossRef response: no `status` field.'));\n    if (body.status !== 'ok') return cb(new Error('CrossRef error: ' + body.status));\n    cb(null, body.message);\n  });\n} // make a method that just returns the one item\n\n\nfunction item(urlTmpl) {\n  return function (param, cb) {\n    return GET(urlTmpl.replace('{param}', param), cb);\n  };\n} // backend for list requests\n\n\nfunction listRequest(path) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var cb = arguments[2];\n\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  } // serialise options\n\n\n  var opts = [];\n\n  for (var k in options) {\n    // The whole URL *minus* the scheme and \"://\" (for whatever benighted reason) has to be at most\n    // 4096 characters long. Taking the extra bloat that `encodeURIComponent()` adds we truncate the\n    // query to 2000 chars. We could be more precise and regenerate the URL until we reach as close\n    // as possible to 4096, but frankly if you're searching for a string longer than 2000 characters\n    // you're probably doing something wrong.\n    if (k === 'query') {\n      if (options.query.length > 2000) options.query = options.query.substr(0, 2000);\n      opts.push('query=' + encodeURIComponent(options.query));\n    } else if (k === 'filter') {\n      (function () {\n        var filts = [];\n\n        var _loop = function _loop(f) {\n          if (Array.isArray(options.filter[f])) {\n            options.filter[f].forEach(function (val) {\n              filts.push(f + ':' + val);\n            });\n          } else {\n            filts.push(f + ':' + options.filter[f]);\n          }\n        };\n\n        for (var f in options.filter) {\n          _loop(f);\n        }\n\n        opts.push('filter=' + filts.join(','));\n      })();\n    } else if (k === 'facet' && options.facet) opts.push('facet=t');else opts.push(k + '=' + options[k]);\n  }\n\n  if (opts.length) path += '?' + opts.join('&');\n  return GET(path, function (err, msg) {\n    if (err) return cb(err);\n    var objects = msg.items;\n    delete msg.items;\n    var nextOffset = 0,\n        isDone = false,\n        nextOptions = void 0; // /types is a list but it does not behave like the other lists\n    // Once again the science.ai League of JStice saves the day papering over inconsistency!\n\n    if (msg['items-per-page'] && msg.query) {\n      nextOffset = msg.query['start-index'] + msg['items-per-page'];\n      if (nextOffset > msg['total-results']) isDone = true;\n      nextOptions = (0, _assign2.default)({}, options, {\n        offset: nextOffset\n      });\n    } else {\n      isDone = true;\n      nextOptions = (0, _assign2.default)({}, options);\n    }\n\n    cb(null, objects, nextOptions, isDone, msg);\n  });\n} // make a method that returns a list that can be\n\n\nfunction list(path) {\n  return function (options, cb) {\n    return listRequest(path, options, cb);\n  };\n}\n\nfunction itemList(urlTmpl) {\n  return function (param, options, cb) {\n    return listRequest(urlTmpl.replace('{param}', param), options, cb);\n  };\n} // Actual API\n// /works/{doi} returns metadata for the specified CrossRef DOI.\n// /funders/{funder_id} returns metadata for specified funder and its suborganizations\n// /prefixes/{owner_prefix} returns metadata for the DOI owner prefix\n// /members/{member_id} returns metadata for a CrossRef member\n// /types/{type_id} returns information about a metadata work type\n// /journals/{issn} returns information about a journal with the given ISSN\n\n\nvar work = exports.work = item('works/{param}');\nvar funder = exports.funder = item('funders/{param}');\nvar prefix = exports.prefix = item('prefixes/{param}');\nvar member = exports.member = item('members/{param}');\nvar type = exports.type = item('types/{param}');\nvar journal = exports.journal = item('journals/{param}'); // /funders/{funder_id}/works   returns list of works associated with the specified funder_id\n// /types/{type_id}/works   returns list of works of type type\n// /prefixes/{owner_prefix}/works   returns list of works associated with specified owner_prefix\n// /members/{member_id}/works   returns list of works associated with a CrossRef member\n//                                  (deposited by a CrossRef member)\n// /journals/{issn}/works   returns a list of works in the given journal\n\nvar funderWorks = exports.funderWorks = itemList('funders/{param}/works');\nvar prefixWorks = exports.prefixWorks = itemList('prefixes/{param}/works');\nvar memberWorks = exports.memberWorks = itemList('members/{param}/works');\nvar journalWorks = exports.journalWorks = itemList('journals/{param}/works'); // /works   returns a list of all works (journal articles, conference proceedings, books,\n//                components, etc), 20 per page\n// /funders   returns a list of all funders in the FundRef Registry\n// /members   returns a list of all CrossRef members (mostly publishers)\n// /types   returns a list of valid work types\n// /licenses   return a list of licenses applied to works in CrossRef metadata\n// /journals   return a list of journals in the CrossRef database\n\nvar works = exports.works = list('works');\nvar funders = exports.funders = list('funders');\nvar members = exports.members = list('members');\nvar types = exports.types = list('types');\nvar licenses = exports.licenses = list('licenses');\nvar journals = exports.journals = list('journals'); // everything in one big ball\n\nvar CrossRef = {\n  work: work,\n  funder: funder,\n  prefix: prefix,\n  member: member,\n  type: type,\n  journal: journal,\n  funderWorks: funderWorks,\n  prefixWorks: prefixWorks,\n  memberWorks: memberWorks,\n  journalWorks: journalWorks,\n  works: works,\n  funders: funders,\n  members: members,\n  types: types,\n  licenses: licenses,\n  journals: journals\n};\nexports.default = CrossRef;","map":{"version":3,"sources":["C:/data-retrieve-task/node_modules/crossref/index.js"],"names":["Object","defineProperty","exports","value","journals","licenses","types","members","funders","works","journalWorks","memberWorks","prefixWorks","funderWorks","journal","type","member","prefix","funder","work","undefined","_typeof","Symbol","iterator","obj","constructor","prototype","_request","require","_request2","_interopRequireDefault","_assign","_assign2","__esModule","default","endpoint","timeout","GET","path","cb","url","json","err","res","body","statusCode","statusMessage","headers","limit","interval","Error","msg","message","status","item","urlTmpl","param","replace","listRequest","options","arguments","length","opts","k","query","substr","push","encodeURIComponent","filts","_loop","f","Array","isArray","filter","forEach","val","join","facet","objects","items","nextOffset","isDone","nextOptions","offset","list","itemList","CrossRef"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.journals = exports.licenses = exports.types = exports.members = exports.funders = exports.works = exports.journalWorks = exports.memberWorks = exports.prefixWorks = exports.funderWorks = exports.journal = exports.type = exports.member = exports.prefix = exports.funder = exports.work = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _request = require('request');\n\nvar _request2 = _interopRequireDefault(_request);\n\nvar _assign = require('lodash/assign');\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar endpoint = 'https://api.crossref.org/';\nvar timeout = 60 * 1000; // CrossRef is *very* slow\n\n// make a request\nfunction GET(path, cb) {\n  // console.log(`### ${endpoint}${path}`);\n  (0, _request2.default)({ url: '' + endpoint + path, json: true, timeout: timeout }, function (err, res, body) {\n    if (err || !res || res.statusCode >= 400) {\n      var statusCode = res ? res.statusCode : 0,\n          statusMessage = res ? res.statusMessage : 'Unspecified error (likely a timeout)';\n\n      if (statusCode === 429) {\n        var headers = res.headers || {},\n            limit = headers['x-rate-limit-limit'] || 'N/A',\n            interval = headers['x-rate-limit-interval'] || 'N/A';\n        return cb(new Error('Rate limit exceeded: ' + limit + ' requests in ' + interval));\n      }\n      if (statusCode === 404) return cb(new Error('Not found on CrossRef: \\'' + endpoint + path + '\\''));\n      var msg = err && err.message ? err.message : statusMessage;\n      return cb(new Error('CrossRef error: [' + statusCode + '] ' + msg));\n    }\n    if ((typeof body === 'undefined' ? 'undefined' : _typeof(body)) !== 'object') return cb(new Error('CrossRef response was not JSON: ' + body));\n    if (!body.status) return cb(new Error('Malformed CrossRef response: no `status` field.'));\n    if (body.status !== 'ok') return cb(new Error('CrossRef error: ' + body.status));\n    cb(null, body.message);\n  });\n}\n\n// make a method that just returns the one item\nfunction item(urlTmpl) {\n  return function (param, cb) {\n    return GET(urlTmpl.replace('{param}', param), cb);\n  };\n}\n\n// backend for list requests\nfunction listRequest(path) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var cb = arguments[2];\n\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n  // serialise options\n  var opts = [];\n  for (var k in options) {\n    // The whole URL *minus* the scheme and \"://\" (for whatever benighted reason) has to be at most\n    // 4096 characters long. Taking the extra bloat that `encodeURIComponent()` adds we truncate the\n    // query to 2000 chars. We could be more precise and regenerate the URL until we reach as close\n    // as possible to 4096, but frankly if you're searching for a string longer than 2000 characters\n    // you're probably doing something wrong.\n    if (k === 'query') {\n      if (options.query.length > 2000) options.query = options.query.substr(0, 2000);\n      opts.push('query=' + encodeURIComponent(options.query));\n    } else if (k === 'filter') {\n      (function () {\n        var filts = [];\n\n        var _loop = function _loop(f) {\n          if (Array.isArray(options.filter[f])) {\n            options.filter[f].forEach(function (val) {\n              filts.push(f + ':' + val);\n            });\n          } else {\n            filts.push(f + ':' + options.filter[f]);\n          }\n        };\n\n        for (var f in options.filter) {\n          _loop(f);\n        }\n        opts.push('filter=' + filts.join(','));\n      })();\n    } else if (k === 'facet' && options.facet) opts.push('facet=t');else opts.push(k + '=' + options[k]);\n  }\n  if (opts.length) path += '?' + opts.join('&');\n  return GET(path, function (err, msg) {\n    if (err) return cb(err);\n    var objects = msg.items;\n    delete msg.items;\n    var nextOffset = 0,\n        isDone = false,\n        nextOptions = void 0;\n    // /types is a list but it does not behave like the other lists\n    // Once again the science.ai League of JStice saves the day papering over inconsistency!\n    if (msg['items-per-page'] && msg.query) {\n      nextOffset = msg.query['start-index'] + msg['items-per-page'];\n      if (nextOffset > msg['total-results']) isDone = true;\n      nextOptions = (0, _assign2.default)({}, options, { offset: nextOffset });\n    } else {\n      isDone = true;\n      nextOptions = (0, _assign2.default)({}, options);\n    }\n    cb(null, objects, nextOptions, isDone, msg);\n  });\n}\n\n// make a method that returns a list that can be\nfunction list(path) {\n  return function (options, cb) {\n    return listRequest(path, options, cb);\n  };\n}\nfunction itemList(urlTmpl) {\n  return function (param, options, cb) {\n    return listRequest(urlTmpl.replace('{param}', param), options, cb);\n  };\n}\n\n// Actual API\n// /works/{doi} returns metadata for the specified CrossRef DOI.\n// /funders/{funder_id} returns metadata for specified funder and its suborganizations\n// /prefixes/{owner_prefix} returns metadata for the DOI owner prefix\n// /members/{member_id} returns metadata for a CrossRef member\n// /types/{type_id} returns information about a metadata work type\n// /journals/{issn} returns information about a journal with the given ISSN\nvar work = exports.work = item('works/{param}');\nvar funder = exports.funder = item('funders/{param}');\nvar prefix = exports.prefix = item('prefixes/{param}');\nvar member = exports.member = item('members/{param}');\nvar type = exports.type = item('types/{param}');\nvar journal = exports.journal = item('journals/{param}');\n\n// /funders/{funder_id}/works   returns list of works associated with the specified funder_id\n// /types/{type_id}/works   returns list of works of type type\n// /prefixes/{owner_prefix}/works   returns list of works associated with specified owner_prefix\n// /members/{member_id}/works   returns list of works associated with a CrossRef member\n//                                  (deposited by a CrossRef member)\n// /journals/{issn}/works   returns a list of works in the given journal\nvar funderWorks = exports.funderWorks = itemList('funders/{param}/works');\nvar prefixWorks = exports.prefixWorks = itemList('prefixes/{param}/works');\nvar memberWorks = exports.memberWorks = itemList('members/{param}/works');\nvar journalWorks = exports.journalWorks = itemList('journals/{param}/works');\n\n// /works   returns a list of all works (journal articles, conference proceedings, books,\n//                components, etc), 20 per page\n// /funders   returns a list of all funders in the FundRef Registry\n// /members   returns a list of all CrossRef members (mostly publishers)\n// /types   returns a list of valid work types\n// /licenses   return a list of licenses applied to works in CrossRef metadata\n// /journals   return a list of journals in the CrossRef database\nvar works = exports.works = list('works');\nvar funders = exports.funders = list('funders');\nvar members = exports.members = list('members');\nvar types = exports.types = list('types');\nvar licenses = exports.licenses = list('licenses');\nvar journals = exports.journals = list('journals');\n\n// everything in one big ball\nvar CrossRef = {\n  work: work,\n  funder: funder,\n  prefix: prefix,\n  member: member,\n  type: type,\n  journal: journal,\n  funderWorks: funderWorks,\n  prefixWorks: prefixWorks,\n  memberWorks: memberWorks,\n  journalWorks: journalWorks,\n  works: works,\n  funders: funders,\n  members: members,\n  types: types,\n  licenses: licenses,\n  journals: journals\n};\nexports.default = CrossRef;\n"]},"metadata":{},"sourceType":"script"}